<template>
    <div>
            <div class="compass-icon icon-up" >
            <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 451.847 451.846"
                 style="enable-background:new 0 0 451.847 451.846;" xml:space="preserve">
                <path d="M248.292,106.406l194.281,194.29c12.365,12.359,12.365,32.391,0,44.744c-12.354,12.354-32.391,12.354-44.744,0
                 L225.923,173.529L54.018,345.44c-12.36,12.354-32.395,12.354-44.748,0c-12.359-12.354-12.359-32.391,0-44.75L203.554,106.4
                 c6.18-6.174,14.271-9.259,22.369-9.259C234.018,97.141,242.115,100.232,248.292,106.406z" stroke-width="35" stroke="#fff" fill="#fff" />
            </svg>
            </div>
            <div class="compass-icon icon-down">
            <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"  viewBox="0 0 451.847 451.847"
                style="enable-background:new 0 0 451.847 451.847;" xml:space="preserve">
                <path d="M225.923,354.706c-8.098,0-16.195-3.092-22.369-9.263L9.27,151.157c-12.359-12.359-12.359-32.397,0-44.751
                c12.354-12.354,32.388-12.354,44.748,0l171.905,171.915l171.906-171.909c12.359-12.354,32.391-12.354,44.744,0
                c12.365,12.354,12.365,32.392,0,44.751L248.292,345.449C242.115,351.621,234.018,354.706,225.923,354.706z"
                stroke-width="35" stroke="#fff" fill="#fff" />
            </svg>
            </div>
            <div class="compass-icon icon-left">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 492 492" >
                 <path d="M198.608,246.104L382.664,62.04c5.068-5.056,7.856-11.816,7.856-19.024c0-7.212-2.788-13.968-7.856-19.032l-16.128-16.12
                   C361.476,2.792,354.712,0,347.504,0s-13.964,2.792-19.028,7.864L109.328,227.008c-5.084,5.08-7.868,11.868-7.848,19.084
                   c-0.02,7.248,2.76,14.028,7.848,19.112l218.944,218.932c5.064,5.072,11.82,7.864,19.032,7.864c7.208,0,13.964-2.792,19.032-7.864
                   l16.124-16.12c10.492-10.492,10.492-27.572,0-38.06L198.608,246.104z"  stroke-width="35" stroke="#fff" fill="#fff"/>
            </svg>
            </div>
            <div class="compass-icon icon-right">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 492 492" >
                 <path d="M382.678,226.804L163.73,7.86C158.666,2.792,151.906,0,144.698,0s-13.968,2.792-19.032,7.86l-16.124,16.12
                   c-10.492,10.504-10.492,27.576,0,38.064L293.398,245.9l-184.06,184.06c-5.064,5.068-7.86,11.824-7.86,19.028
                   c0,7.212,2.796,13.968,7.86,19.04l16.124,16.116c5.068,5.068,11.824,7.86,19.032,7.86s13.968-2.792,19.032-7.86L382.678,265
                   c5.076-5.084,7.864-11.872,7.848-19.088C390.542,238.668,387.754,231.884,382.678,226.804z" stroke-width="35" stroke="#fff" fill="#fff"/>
            </svg>
            </div>
        <div class="compass-container">
            <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 288 288">
                <title>compass_vector</title>
                <g id="Base">
                    <path d="M432,153
                             a135,135,0,1,1-95.46,39.54
                             A134.11,134.11,0,0,1,432,153
                             m0 -9
                             A144,144,0,1,0,576,288,144,144,0,0,0,432,144
                             Z" 
                             transform="translate(-288 -144)"  stroke-width="1" stroke="black" fill="white"/>
                    <path d="M432,168.5
                             A119.5,119.5,0,1,1,312.5,288,119.64,119.64,0,0,1,432,168.5
                             m0 -1.5
                             A121,121,0,1,0,553,288,121.14,121.14,0,0,0,432,167
                             Z" 
                             transform="translate(-288 -144)" stroke-width="45" stroke="black" fill="white"
                    />
                    <circle cx="144" cy="144" r="74.5" style="fill: none;stroke: #000;stroke-miterlimit: 10" />
                </g>
                <g id="Spinner">
                    <g>
                        <g>
                            <polygon points="164.15 144.12 144.31 190.1 124.47 144.12 164.15 144.12" style="fill: black" />
                            <g>
                                <polygon points="125.23 143.49 144.31 99.26 163.39 143.49 125.23 143.49"
                                    style="fill: red" />
                                <path d="M432.31,244.52,450.63,287H414l18.32-42.47m0-2.52-19.84,46h39.68l-19.84-46Z"
                                    transform="translate(-288 -144)" />
                            </g>
                        </g>
                        <g>
                            <circle cx="144" cy="144" r="8" style="fill: #fff;stroke: #000;stroke-miterlimit: 10" />
                            <circle cx="144" cy="144" r="5.33" />
                        </g>
                    </g>
                </g>
            </svg>
        </div>
        <div class="box">
            <div class="plus"><div class="plus-icon"></div></div>
            <div class="minus"><div class="minus-icon"></div></div>
        </div>
    </div>
</template>

<script>
import $ from 'jquery'
export default {
    name:"compass",
    props:{
      viewer:Object,
      Cesium:Object,
    },
    mounted(){
      this.bindEvent('verticalMove',".icon-up", "up");
      this.bindEvent("verticalMove",".icon-down", "down");
      this.bindEvent("levelMove",".icon-left", "left");
      this.bindEvent("levelMove",".icon-right", "right");
      this.bindEvent("zoomEvent",".plus", "in");
      this.bindEvent("zoomEvent",".minus", "out");
    },
    methods:{
        getPosition(){
            return this.viewer.camera.pickEllipsoid(new this.Cesium.Cartesian2(window.innerWidth / 2, window.innerHeight / 2), this.viewer.scene.globe.ellipsoid);
        },
        verticalMove(position, direction){
            if (!position) {
               return
            }
           var camera = this.viewer.scene.camera;
           var ellipsoid = this.viewer.scene.globe.ellipsoid;
           var mag = Cesium.Cartesian3.magnitude(position);
           var radii = Cesium.Cartesian3.fromElements(mag, mag, mag, new this.Cesium.Cartesian3());
           var newEllipsoid = Cesium.Ellipsoid.fromCartesian3(radii, new this.Cesium.Ellipsoid());
           this.viewer.scene._screenSpaceCameraController._rotateFactor = 1.0;
           this.viewer.scene._screenSpaceCameraController._rotateRateRangeAdjustment = 1.0;
           camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;
           var oldTransform = Cesium.Matrix4.clone(camera.transform, new this.Cesium.Matrix4());
           var transform = Cesium.Transforms.eastNorthUpToFixedFrame(position, ellipsoid, new this.Cesium.Matrix4());
           var verticalTransform = Cesium.Transforms.eastNorthUpToFixedFrame(position, newEllipsoid, new this.Cesium.Matrix4());
           camera._setTransform(verticalTransform);
           if (direction == "up") {
             if (camera.pitch > -0.1) {
                camera.rotateUp(0)
             } else {
                camera.rotateUp(0.005);
             }
           } else {
             camera.rotateDown(0.005)
           }
           camera._setTransform(oldTransform);
        },
        levelMove(position,direction){
            direction=="left"?this.viewer.scene.camera.rotate(getPosition(), 0.01):this.viewer.scene.camera.rotate(position, -0.01)
        },
        zoomEvent(direction){
            var cameraPos = this.viewer.scene.camera.position;
            var ellipsoid = this.viewer.scene.globe.ellipsoid
            var cartographic = ellipsoid.cartesianToCartographic(cameraPos)
            var height = cartographic.height;
            direction=="in" ? this.viewer.camera.zoomIn(height < 1 ? 0 : height / 100) : this.viewer.camera.zoomOut(height > Math.pow(10, 8) ? 0 : height * 0.01)
        },
        selectEvent(eventName,direction){
         switch(eventName){
          case "levelMove":levelMove(getPosition(),direction);
             break;
          case "verticalMove":verticalMove(getPosition(),direction);
             break;
          case "zoomEvent":zoomEvent(direction)
             break;
          }
        },
        bindEvent(eventName,className,direction){
         var timer;
         $(className).bind({
          click: function () {
            this.selectEvent(eventName,direction);
          },
          mousedown: function () {
            timer = setInterval(function () {
                this.selectEvent(eventName,direction);
            }, 10)
          },
          mouseup: function () {
            clearInterval(timer)
          },
          mouseout: function () {
            clearInterval(timer)
          }
          })
        }
    }
}
</script>

<style scoped>
#Spinner {
    transform-origin: 50% 50%;
    cursor: pointer;
}
.compass-container {
    position: fixed;
    bottom: 40px;
    right: 40px;
    width: 100px;
    height: 100px;
    z-index: 10;
}
.compass-icon{
    width: 15px;
    height: 15px;
    position: fixed ;
    z-index: 100;
    cursor: pointer;
}
.icon-up{
    bottom: 126px;
    right: 83px;
}
.icon-down{
    bottom: 43px;
    right: 83px;
}
.icon-left{
    bottom: 85px;
    right: 124px;
}
.icon-right{
    bottom: 85px;
    right: 40px;
}

/* zoom button */
.box{
    position: absolute;
    height: 70px;
    width: 15px;
    bottom: 160px;
    right: 82px;
}
.plus,.minus{
    width: 15px;
    height: 39.5px;
    cursor: pointer;
}
.plus-icon,.minus-icon{
    position: relative;
    top: 10px;
    width: 15px;
    height: 2px;
    background-color:  white;
}
.plus-icon:after{
    content: "";
    width: 15px;
    height: 2px;
    background-color:  white;
    position: absolute;
    transform: rotate(90deg);
}
</style>